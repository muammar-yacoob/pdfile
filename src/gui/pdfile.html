<!DOCTYPE html>
<html data-pdfile data-width="700" data-height="590">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>PDFile - PDF Utility Toolkit</title>
    <link rel="icon" href="img/logo.ico">
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="/css/flatpickr.min.css">
    <link rel="stylesheet" href="/css/pickr-nano.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&family=Source+Sans+Pro:wght@400;700&family=Montserrat:wght@400;700&family=Oswald:wght@400;700&family=Raleway:wght@400;700&family=PT+Sans:wght@400;700&family=Merriweather:wght@400;700&family=Nunito:wght@400;700&family=Playfair+Display:wght@400;700&family=Ubuntu:wght@400;700&family=Poppins:wght@400;700&family=Work+Sans:wght@400;700&family=Noto+Sans:wght@400;700&family=Fira+Sans:wght@400;700&family=Inter:wght@400;700&family=Quicksand:wght@400;700&family=Josefin+Sans:wght@400;700&family=Bebas+Neue&display=swap" rel="stylesheet">
    <script src="/js/lucide.min.js"></script>
    <script src="/js/pdf.min.js"></script>
    <script src="/js/flatpickr.min.js"></script>
    <script src="/js/pickr.min.js"></script>
    <script src="/js/color-picker.js"></script>
    <style>
        * { box-sizing: border-box; }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: #7fa5df;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a3b8d9;
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 10px;
            gap: 8px;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--brd);
            flex-shrink: 0;
        }

        .header b {
            font-size: 14px;
            background: linear-gradient(135deg, #7fa5df, #a3b8d9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header span {
            font-size: 11px;
            color: var(--txt3);
            flex: 1;
        }

        .header-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--brd);
            border-radius: 6px;
            color: var(--txt3);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .header-btn:hover {
            background: var(--bg2);
            border-color: #7fa5df;
            color: #7fa5df;
        }

        .header-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Dark mode for flatpickr calendar */
        .flatpickr-calendar {
            background: var(--bg2) !important;
            border: 1px solid var(--brd) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;
            max-width: 280px !important;
            font-size: 13px !important;
        }

        .flatpickr-day {
            max-width: 35px !important;
            height: 35px !important;
            line-height: 35px !important;
        }

        .flatpickr-months {
            background: var(--bg) !important;
        }

        .flatpickr-month, .flatpickr-current-month .flatpickr-monthDropdown-months {
            color: var(--txt) !important;
        }

        .flatpickr-weekdays {
            background: var(--bg) !important;
        }

        .flatpickr-weekday {
            color: var(--txt3) !important;
        }

        .flatpickr-day {
            color: var(--txt) !important;
        }

        .flatpickr-day:hover, .flatpickr-day.selected {
            background: #7fa5df !important;
            border-color: #7fa5df !important;
        }

        .flatpickr-day.today {
            border-color: #7fa5df !important;
        }

        /* Main 3-column layout */
        .main {
            display: flex;
            flex: 1;
            gap: 0;
            overflow: hidden;
        }

        .panel-resizer {
            width: 4px;
            background: var(--brd);
            cursor: col-resize;
            flex-shrink: 0;
            transition: background 0.2s;
            position: relative;
            margin-right: 4px;
        }

        .panel-resizer:hover {
            background: #7fa5df;
        }

        .panel-resizer.dragging {
            background: #7fa5df;
        }

        /* Left: Page Thumbnails */
        .thumbnails-panel {
            flex: 0 0 160px;
            min-width: 120px;
            max-width: 400px;
            background: var(--bg2);
            border-radius: 6px;
            border: 1px solid var(--brd);
            display: flex;
            margin-right: 4px;
            flex-direction: column;
            overflow: hidden;
            transition: width 0.3s ease;
        }

        .thumbnails-panel.collapsed {
            width: 40px;
        }

        .thumbnails-panel.collapsed .thumbnails-list {
            display: none;
        }

        .thumbnails-header {
            padding: 6px 8px;
            border-bottom: 1px solid var(--brd);
            font-size: 10px;
            font-weight: 600;
            color: var(--txt2);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .thumbnails-header .collapse-btn {
            width: 20px;
            height: 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--txt3);
            transition: color 0.2s;
        }

        .thumbnails-header .collapse-btn:hover {
            color: #7fa5df;
        }

        .thumbnails-panel.collapsed .thumbnails-header {
            flex-direction: column;
            gap: 4px;
        }

        .thumbnails-panel.collapsed .thumbnails-header span {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
        }

        /* Page Actions Toolbar */
        .page-actions-toolbar {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px;
            border-bottom: 1px solid var(--brd);
            background: var(--bg);
        }

        .page-action-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--brd);
            border-radius: 4px;
            color: var(--txt2);
            cursor: pointer;
            transition: all 0.2s;
        }

        .page-action-btn:hover:not(:disabled) {
            background: var(--bg2);
            border-color: #7fa5df;
            color: #7fa5df;
        }

        .page-action-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Arrow buttons - blue when enabled */
        .page-action-btn:not(:disabled).arrow-btn {
            color: #7fa5df;
            border-color: #7fa5df;
        }

        .page-action-btn:not(:disabled).arrow-btn:hover {
            background: rgba(127, 165, 223, 0.1);
            border-color: #a3b8d9;
            color: #a3b8d9;
        }

        /* Trash button - always dark red */
        .page-action-btn.delete-btn {
            color: #dc3545;
            border-color: #dc3545;
        }

        .page-action-btn.delete-btn:hover:not(:disabled) {
            background: rgba(220, 53, 69, 0.1);
            border-color: #c82333;
            color: #c82333;
        }

        .page-action-btn.delete-btn:disabled {
            color: #dc3545;
            border-color: #dc3545;
            opacity: 0.3;
        }

        .thumbnails-list {
            flex: 1;
            overflow-y: auto;
            padding: 6px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .thumbnail-item {
            background: var(--bg);
            border: 3px solid var(--brd);
            border-radius: 6px;
            cursor: grab;
            position: relative;
            transition: all 0.2s;
            user-select: none;
            overflow: hidden;
        }

        .thumbnail-item:hover {
            border-color: #7fa5df;
            transform: translateX(2px);
        }

        .thumbnail-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .thumbnail-item.dragover {
            border-color: #7fa5df;
            background: rgba(127, 165, 223, 0.1);
        }

        /* Drop zone highlighting */
        .drop-zone-active {
            position: relative;
            outline: 3px dashed #7fa5df !important;
            outline-offset: -8px;
            background: rgba(127, 165, 223, 0.15) !important;
        }

        .drop-zone-active::before {
            content: 'Drop here to merge as pages';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(127, 165, 223, 0.95);
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .preview-area.drop-zone-active::before {
            content: 'Drop here for options...';
        }

        .thumbnail-canvas {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 3px;
        }

        .thumbnail-number {
            position: absolute;
            top: 4px;
            left: 4px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
        }

        .thumbnail-source-label {
            position: absolute;
            bottom: 4px;
            left: 4px;
            right: 4px;
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 8px;
            font-weight: 600;
            color: #fff;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: none;
        }

        .show-source-labels .thumbnail-source-label {
            display: block;
        }

        .thumbnail-item.selected {
            border: 4px solid #ffffff !important;
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 0 1px rgba(127, 165, 223, 0.3), 0 0 16px rgba(127, 165, 223, 0.4);
            position: relative;
        }

        .thumbnail-item.selected .thumbnail-checkmark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 44px;
            height: 44px;
            background: #7fa5df;
            border: 3px solid #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 10;
            color: #ffffff;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
        }

        .thumbnail-item.selected .thumbnail-checkmark i {
            width: 24px !important;
            height: 24px !important;
            stroke-width: 3.5px;
        }

        /* Dim unselected thumbnails when any page is selected */
        .thumbnails-list:has(.thumbnail-item.selected) .thumbnail-item:not(.selected) {
            opacity: 0.4;
            filter: grayscale(0.3);
        }

        .thumbnails-list:has(.thumbnail-item.selected) .thumbnail-item:not(.selected):hover {
            opacity: 0.7;
        }

        /* Center: PDF Preview */
        .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 400px;
        }

        .preview-area {
            flex: 1;
            background: var(--bg2);
            border-radius: 6px;
            border: 1px solid var(--brd);
            overflow: auto;
            position: relative;
            cursor: grab;
            text-align: center;
            font-size: 0; /* Remove whitespace from inline-block */
        }

        /* Vertical centering helper */
        .preview-area::after {
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
        }

        .preview-area.panning {
            cursor: grabbing;
        }

        .preview-area::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .preview-area::-webkit-scrollbar-track {
            background: var(--bg);
        }
        .preview-area::-webkit-scrollbar-thumb {
            background: #7fa5df;
            border-radius: 4px;
        }
        .preview-area::-webkit-scrollbar-thumb:hover {
            background: #a3b8d9;
        }

        .preview-area::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-conic-gradient(#1a1a1d 0% 25%, #222 0% 50%) 50%/16px 16px;
            z-index: 0;
        }

        .canvas-wrapper {
            position: relative;
            z-index: 1;
            display: inline-block;
            vertical-align: middle;
            margin: 20px;
        }

        .preview-area canvas {
            display: block;
            background: #fff;
        }

        .preview-area .placeholder {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            color: var(--txt3);
            font-size: 12px;
        }

        .load-btn {
            padding: 8px 16px;
            font-size: 11px;
            background: var(--bg2);
            border: 1px dashed var(--brd);
            border-radius: 6px;
            color: var(--txt3);
            cursor: pointer;
            transition: all 0.2s;
        }

        .load-btn:hover {
            border-color: #7fa5df;
            color: #7fa5df;
        }

        /* Hotkeys Display */
        .preview-hotkeys {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 26, 29, 0.95);
            border: 1px solid var(--brd);
            border-radius: 50%;
            z-index: 100;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(8px);
            font-size: 8px;
            color: var(--txt3);
            pointer-events: auto;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            width: 24px;
            height: 24px;
        }

        .preview-hotkeys.expanded {
            border-radius: 6px;
            width: auto;
            height: auto;
        }

        .hotkey-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            color: var(--txt2);
            transition: color 0.2s;
            flex-shrink: 0;
        }

        .preview-hotkeys:hover .hotkey-icon {
            color: #7fa5df;
        }

        .hotkey-content {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 0;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
        }

        .preview-hotkeys.expanded .hotkey-content {
            max-height: 200px;
            opacity: 1;
            padding: 0 12px 12px 12px;
        }

        .hotkey-item {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .hotkey-item kbd {
            background: var(--bg2);
            border: 1px solid var(--brd);
            border-radius: 3px;
            padding: 2px 6px;
            font-family: monospace;
            font-size: 9px;
            color: var(--txt);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .hotkey-item span {
            color: var(--txt3);
        }

        /* Zoom Controls */
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(26, 26, 29, 0.95);
            border: 1px solid var(--brd);
            border-radius: 4px;
            padding: 3px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 2px;
            backdrop-filter: blur(8px);
        }

        .zoom-btn {
            background: var(--bg2);
            border: 1px solid var(--brd);
            border-radius: 3px;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--txt2);
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: var(--bg3);
            border-color: #7fa5df;
            color: #7fa5df;
        }

        .zoom-btn:active {
            transform: scale(0.95);
        }

        .zoom-display {
            min-width: 35px;
            text-align: center;
            font-size: 9px;
            font-weight: 600;
            color: var(--txt);
            padding: 0 4px;
            font-variant-numeric: tabular-nums;
        }

        /* Processing Overlay */
        .processing-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }

        .processing-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .processing-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(127, 165, 223, 0.3);
            border-top-color: #7fa5df;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .processing-text {
            font-size: 14px;
            font-weight: 500;
            color: #fff;
            letter-spacing: 0.5px;
        }

        /* Overlay gizmo */
        .overlay-gizmo {
            position: absolute;
            border: none;
            background: transparent;
            cursor: move;
            z-index: 10;
            min-width: 60px;
            min-height: 30px;
            padding: 0;
            user-select: none;
            transition: all 0.15s ease;
            box-sizing: border-box;
        }

        .overlay-gizmo img {
            width: 100%;
            height: 100%;
            object-fit: fill;
            pointer-events: none;
        }

        .overlay-gizmo-text {
            font-size: 10px;
            color: #7fa5df;
            text-align: left;
            word-break: break-word;
            padding: 0;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            width: 100%;
            height: 100%;
            max-width: 100%;
            pointer-events: none;
        }

        .overlay-gizmo-rectangle,
        .overlay-gizmo-image-preview {
            pointer-events: none;
        }

        .overlay-gizmo:hover {
            background: rgba(127, 165, 223, 0.08);
            border: 2px solid #7fa5df;
        }

        .overlay-gizmo.selected {
            border: 2px solid #7fa5df !important;
            background: rgba(127, 165, 223, 0.12) !important;
            box-shadow: 0 0 0 2px rgba(127, 165, 223, 0.3), 0 0 12px rgba(127, 165, 223, 0.5);
        }

        /* Resize handles - tiny squares */
        .overlay-gizmo-handle {
            position: absolute;
            background: #7fa5df;
            border: 1px solid #fff;
            border-radius: 1px;
            z-index: 11;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        /* Corner handles - lock aspect ratio - larger and brighter */
        .overlay-gizmo-handle.se,
        .overlay-gizmo-handle.sw,
        .overlay-gizmo-handle.ne,
        .overlay-gizmo-handle.nw {
            width: 9px;
            height: 9px;
            background: #7fa5df;
        }

        .overlay-gizmo-handle.nw { top: -5px; left: -5px; cursor: nwse-resize; }
        .overlay-gizmo-handle.ne { top: -5px; right: -5px; cursor: nesw-resize; }
        .overlay-gizmo-handle.sw { bottom: -5px; left: -5px; cursor: nesw-resize; }
        .overlay-gizmo-handle.se { bottom: -5px; right: -5px; cursor: nwse-resize; }

        /* Side handles - free resize - smaller and darker */
        .overlay-gizmo-handle.n,
        .overlay-gizmo-handle.s,
        .overlay-gizmo-handle.w,
        .overlay-gizmo-handle.e {
            width: 6px;
            height: 6px;
            background: rgba(127, 165, 223, 0.7);
        }

        .overlay-gizmo-handle.n { top: -3px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }
        .overlay-gizmo-handle.s { bottom: -3px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }
        .overlay-gizmo-handle.w { top: 50%; left: -3px; transform: translateY(-50%); cursor: ew-resize; }
        .overlay-gizmo-handle.e { top: 50%; right: -3px; transform: translateY(-50%); cursor: ew-resize; }

        .overlay-gizmo:hover .overlay-gizmo-handle,
        .overlay-gizmo.selected .overlay-gizmo-handle {
            opacity: 1;
            pointer-events: auto;
        }

        .overlay-gizmo-rotate {
            position: absolute;
            top: -12px;
            left: -12px;
            width: 24px;
            height: 24px;
            background: #7fa5df;
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: grab;
            z-index: 12;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #000;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .overlay-gizmo:hover .overlay-gizmo-rotate,
        .overlay-gizmo.selected .overlay-gizmo-rotate {
            opacity: 1;
            pointer-events: auto;
        }

        .overlay-gizmo-rotate:hover {
            background: #9fbee8;
            transform: scale(1.1);
        }

        .overlay-gizmo-rotate:active {
            cursor: grabbing;
            transform: scale(0.95);
        }

        /* Rotation guide circle */
        .rotation-guide {
            position: absolute;
            border: 2px dashed rgba(127, 165, 223, 0.5);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
        }

        .rotation-guide::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: #7fa5df;
            border-radius: 50%;
            box-shadow: 0 0 0 2px #fff;
        }

        .overlay-gizmo-label {
            display: none; /* Hidden - unnecessary */
        }

        .overlay-gizmo-delete {
            position: absolute;
            top: -12px;
            right: -12px;
            width: 24px;
            height: 24px;
            background: var(--bg2);
            border: 2px solid #fff;
            border-radius: 50%;
            color: var(--txt3);
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 0;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            z-index: 12;
        }

        .overlay-gizmo:hover .overlay-gizmo-delete,
        .overlay-gizmo.selected .overlay-gizmo-delete {
            opacity: 1;
            pointer-events: auto;
        }

        .overlay-gizmo-delete:hover {
            background: #ff4444;
            color: white;
            border-color: #ff4444;
            transform: scale(1.15);
        }

        .bg-removal-badge {
            position: absolute;
            top: -8px;
            left: -8px;
            background: var(--accent);
            color: #000;
            font-size: 9px;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid var(--brd);
            z-index: 11;
            pointer-events: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .overlay-gizmo-transparent {
            position: absolute;
            top: -22px;
            right: 22px;
            width: 18px;
            height: 18px;
            background: var(--bg2);
            border: 1px solid var(--brd);
            border-radius: 3px;
            color: var(--txt3);
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s;
        }

        .overlay-gizmo:hover .overlay-gizmo-transparent {
            opacity: 1;
            pointer-events: auto;
        }

        .overlay-gizmo-transparent.active {
            background: #7fa5df;
            border-color: #7fa5df;
            color: #000;
        }

        .overlay-gizmo-transparent:hover {
            background: #7fa5df;
            border-color: #7fa5df;
            color: #000;
        }

        .overlay-gizmo.selected .overlay-gizmo-handle,
        .overlay-gizmo.selected .overlay-gizmo-rotate,
        .overlay-gizmo.selected .overlay-gizmo-delete {
            opacity: 1;
            pointer-events: auto;
        }

        /* Layers List */
        .layer-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            background: var(--bg);
            border: 1px solid var(--brd);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 11px;
        }

        .layer-item:hover {
            background: var(--bg3);
            border-color: #7fa5df;
        }

        .layer-item.selected {
            background: rgba(127, 165, 223, 0.15);
            border-color: #7fa5df;
        }

        .layer-icon {
            color: var(--txt3);
            flex-shrink: 0;
        }

        .layer-name {
            flex: 1;
            color: var(--txt);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .layer-controls {
            display: flex;
            gap: 2px;
            flex-shrink: 0;
        }

        .layer-btn {
            width: 18px;
            height: 18px;
            background: transparent;
            border: 1px solid var(--brd);
            border-radius: 3px;
            color: var(--txt3);
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: all 0.2s;
        }

        .layer-btn:hover {
            background: var(--bg3);
            border-color: #7fa5df;
            color: #7fa5df;
        }

        .layer-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Right: Tools */
        .tools-panel {
            width: 240px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            overflow-y: auto;
        }

        .tool {
            background: var(--bg2);
            border: 1px solid var(--brd);
            border-radius: 6px;
            overflow: hidden;
        }

        .tool.active {
            border-color: #7fa5df;
        }

        .tool-header {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 7px 8px;
            user-select: none;
        }

        .tool-header .icon {
            width: 15px;
            height: 15px;
            opacity: 0.6;
            color: var(--txt2);
        }

        .tool.active .tool-header .icon {
            opacity: 1;
            color: #7fa5df;
        }

        .tool-header .name {
            flex: 1;
            font-size: 11px;
            color: var(--txt2);
        }

        .tool.active .tool-header .name {
            color: var(--txt);
            font-weight: 500;
        }

        .tool-body {
            display: none;
            padding: 8px;
            border-top: 1px solid var(--brd);
        }

        .tool.active .tool-body {
            display: block;
        }

        .tool-desc {
            font-size: 10px;
            color: var(--txt3);
            margin-bottom: 10px;
        }

        .tool-btn {
            width: 100%;
            padding: 6px 10px;
            font-size: 10px;
            background: #7fa5df;
            border: none;
            border-radius: 4px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 6px;
        }

        .tool-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .tool-btn:hover {
            background: #a3b8d9;
        }

        .tool-btn.active {
            background: #5a8abf;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .tool-btn-secondary {
            background: var(--bg3);
            color: var(--txt2);
            border: 1px solid var(--brd);
        }

        .tool-btn-secondary:hover {
            background: var(--bg2);
            border-color: #7fa5df;
            color: var(--txt);
        }

        /* Form elements */
        .form-group {
            margin-bottom: 8px;
        }

        .form-label {
            display: block;
            font-size: 9px;
            color: var(--txt2);
            margin-bottom: 3px;
            font-weight: 500;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 5px 7px;
            background: var(--bg);
            border: 1px solid var(--brd);
            border-radius: 4px;
            color: var(--txt);
            font-size: 11px;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #7fa5df;
        }

        .font-select {
            max-height: none;
        }

        .font-select option {
            padding: 6px 8px;
            font-size: 13px;
        }

        .color-picker {
            width: 100%;
            height: 32px;
            cursor: pointer;
            border-radius: 4px;
            border: 1px solid var(--brd);
        }

        /* Toggle buttons */
        .toggle-btn {
            padding: 5px 10px;
            font-size: 10px;
            background: var(--bg);
            border: 1px solid var(--brd);
            border-radius: 4px;
            cursor: pointer;
            color: var(--txt2);
            transition: all 0.2s;
            font-weight: 500;
            white-space: nowrap;
        }

        .toggle-btn:hover {
            background: var(--bg2);
            border-color: #7fa5df;
        }

        .toggle-btn.active {
            background: #7fa5df;
            color: #000;
            border-color: #7fa5df;
            font-weight: 600;
        }

        /* Checkbox labels */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: var(--txt2);
            cursor: pointer;
            user-select: none;
        }

        .checkbox-label input[type="checkbox"] {
            cursor: pointer;
            width: 14px;
            height: 14px;
            accent-color: #7fa5df;
        }

        .checkbox-label span {
            line-height: 1;
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg2);
            border: 1px solid var(--brd);
            transition: 0.3s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 2px;
            bottom: 2px;
            background-color: var(--txt3);
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #7fa5df;
            border-color: #7fa5df;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
            background-color: #fff;
        }

        /* Compact toggle button (Trans) */
        #transparentBtn {
            min-width: 50px;
            padding: 5px 8px;
            font-size: 9px;
            font-weight: 700;
            letter-spacing: 0.3px;
        }


        /* Recent images list */
        .recent-image-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            background: var(--bg);
            border: 1px solid var(--brd);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .recent-image-item:hover {
            background: var(--bg2);
            border-color: #7fa5df;
        }

        .recent-image-item img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 3px;
            border: 1px solid var(--brd);
        }

        .recent-image-item .name {
            flex: 1;
            font-size: 10px;
            color: var(--txt2);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .recent-image-item .insert-btn {
            padding: 4px 8px;
            font-size: 9px;
            background: #7fa5df;
            border: none;
            border-radius: 3px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .recent-image-item .insert-btn:hover {
            background: #a3b8d9;
        }

        /* Color picker with label */
        .color-input-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .color-input-group label {
            font-size: 11px;
            color: var(--txt2);
            font-weight: 500;
            flex-shrink: 0;
        }

        /* Pickr Color Picker Customization */
        .pcr-button {
            width: 32px !important;
            height: 28px !important;
            border-radius: 4px !important;
            border: 1px solid var(--brd) !important;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1) !important;
            cursor: pointer !important;
            transition: all 0.15s ease !important;
        }

        .pcr-button:hover {
            border-color: #7fa5df !important;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 0 0 2px rgba(127, 165, 223, 0.15) !important;
        }

        .pcr-button:focus {
            outline: none !important;
            border-color: #7fa5df !important;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 0 0 2px rgba(127, 165, 223, 0.25) !important;
        }

        .pcr-app {
            background: var(--bg2) !important;
            border: 1px solid var(--brd) !important;
            border-radius: 6px !important;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4) !important;
            padding: 12px !important;
        }

        .pcr-app .pcr-selection {
            margin-bottom: 10px !important;
        }

        .pcr-app .pcr-selection .pcr-picker {
            border-radius: 4px !important;
            border: 1px solid var(--brd) !important;
        }

        .pcr-app .pcr-interaction {
            padding: 8px 0 0 0 !important;
        }

        .pcr-app .pcr-interaction input {
            background: var(--bg) !important;
            color: var(--txt) !important;
            border-color: var(--brd) !important;
            border-radius: 4px !important;
            font-size: 11px !important;
            padding: 4px 6px !important;
        }

        .pcr-app .pcr-interaction .pcr-result {
            background: var(--bg) !important;
            color: var(--txt) !important;
            border-color: var(--brd) !important;
            border-radius: 4px !important;
            font-size: 11px !important;
        }

        .pcr-app .pcr-interaction input:focus {
            border-color: #7fa5df !important;
            outline: none !important;
        }

        .pcr-app .pcr-swatches {
            margin-top: 8px !important;
        }

        .pcr-app .pcr-swatches > button {
            border-radius: 3px !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
        }

        .pcr-eyedropper-btn {
            font-size: 11px !important;
        }

        .pcr-eyedropper-btn:hover {
            background: var(--bg3) !important;
            border-color: #7fa5df !important;
            color: #7fa5df !important;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 10px;
        }

        .tab {
            flex: 1;
            padding: 6px;
            font-size: 10px;
            background: var(--bg);
            border: 1px solid var(--brd);
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            color: var(--txt3);
            transition: all 0.2s;
        }

        .tab.active {
            background: #7fa5df;
            color: #000;
            border-color: #7fa5df;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Custom Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal {
            background: var(--bg);
            border: 1px solid var(--brd);
            border-radius: 8px;
            padding: 20px;
            min-width: 320px;
            max-width: 480px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
        }

        .modal-header {
            font-size: 14px;
            font-weight: 600;
            color: var(--txt);
            margin-bottom: 12px;
        }

        .modal-body {
            font-size: 12px;
            color: var(--txt2);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .modal-footer {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 8px 16px;
            font-size: 11px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn-primary {
            background: #7fa5df;
            color: #000;
        }

        .modal-btn-primary:hover {
            background: #a3b8d9;
        }

        .modal-btn-danger {
            background: #dc3545;
            color: #fff;
        }

        .modal-btn-danger:hover {
            background: #c82333;
        }

        .modal-btn-secondary {
            background: var(--bg2);
            color: var(--txt2);
            border: 1px solid var(--brd);
        }

        .modal-btn-secondary:hover {
            background: var(--bg3);
            color: var(--txt);
        }

        /* Share Modal Styles */
        #shareModal {
            display: none;
        }

        #shareModal.active {
            display: flex;
        }

        .share-modal {
            background: var(--bg);
            border: 1px solid var(--brd);
            border-radius: 10px;
            padding: 24px;
            max-width: 420px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            animation: slideIn 0.3s ease-out;
        }

        .share-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .share-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px;
            background: rgba(127, 165, 223, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--acc);
        }

        .share-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--txt);
            margin: 0 0 6px 0;
        }

        .share-header p {
            font-size: 12px;
            color: var(--txt2);
            margin: 0;
        }

        .share-socials {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .share-social-btn {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--brd);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--txt2);
        }

        .share-social-btn svg {
            width: 20px;
            height: 20px;
        }

        .share-social-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .share-twitter:hover { background: #000000; color: #fff; border-color: #000000; }
        .share-facebook:hover { background: #1877F2; color: #fff; border-color: #1877F2; }
        .share-linkedin:hover { background: #0A66C2; color: #fff; border-color: #0A66C2; }
        .share-reddit:hover { background: #FF4500; color: #fff; border-color: #FF4500; }
        .share-whatsapp:hover { background: #25D366; color: #fff; border-color: #25D366; }
        .share-telegram:hover { background: #0088cc; color: #fff; border-color: #0088cc; }

        .share-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .share-action-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--brd);
            border-radius: 8px;
            color: var(--txt2);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .share-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--txt);
            border-color: var(--acc);
        }

        .share-later-btn {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: none;
            color: var(--txt3);
            font-size: 12px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .share-later-btn:hover {
            color: var(--txt2);
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <div class="header">
            <b>PDFile</b>
            <span id="fileName">No PDF loaded</span>
            <button class="header-btn" onclick="openMergePDF()" title="Merge PDF" id="mergeBtn" disabled>
                <i data-lucide="file-plus"></i>
            </button>
            <button class="header-btn" onclick="exportPDF()" title="Export PDF" id="exportBtn">
                <i data-lucide="download"></i>
            </button>
            <button class="header-btn" onclick="shareApp()" title="Share PDFile">
                <i data-lucide="share-2"></i>
            </button>
        </div>

        <!-- Main 3-column layout -->
        <div class="main">
            <!-- Left: Page Thumbnails -->
            <div class="thumbnails-panel" id="thumbnailsPanel">
                <div class="thumbnails-header">
                    <span>Pages</span>
                    <button class="collapse-btn" onclick="togglePagesPanel()" title="Collapse/Expand">
                        <i data-lucide="chevron-left" style="width: 16px; height: 16px;"></i>
                    </button>
                </div>

                <!-- Action Toolbar (always visible) -->
                <div class="page-actions-toolbar">
                    <button class="page-action-btn" id="toggleSourceLabelsBtn" onclick="toggleSourceLabels()" title="Show/Hide Source File Labels">
                        <i data-lucide="tag" style="width: 14px; height: 14px;"></i>
                    </button>
                    <div style="flex: 1;"></div>
                    <button class="page-action-btn arrow-btn" id="rotateLeftBtn" onclick="rotateSelectedPages(-90)" title="Rotate left 90°" disabled>
                        <i data-lucide="rotate-ccw" style="width: 14px; height: 14px;"></i>
                    </button>
                    <button class="page-action-btn arrow-btn" id="rotateRightBtn" onclick="rotateSelectedPages(90)" title="Rotate right 90°" disabled>
                        <i data-lucide="rotate-cw" style="width: 14px; height: 14px;"></i>
                    </button>
                    <button class="page-action-btn arrow-btn" id="moveUpBtn" onclick="moveSelectedPagesUp()" title="Move up" disabled>
                        <i data-lucide="arrow-up" style="width: 14px; height: 14px;"></i>
                    </button>
                    <button class="page-action-btn arrow-btn" id="moveDownBtn" onclick="moveSelectedPagesDown()" title="Move down" disabled>
                        <i data-lucide="arrow-down" style="width: 14px; height: 14px;"></i>
                    </button>
                    <button class="page-action-btn delete-btn" id="deleteSelectedBtn" onclick="removeSelectedPages()" title="Delete selected" disabled>
                        <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
                    </button>
                </div>

                <div class="thumbnails-list" id="thumbnailsList">
                    <div style="text-align: center; padding: 20px; font-size: 10px; color: var(--txt3);">
                        Load a PDF to see pages
                    </div>
                </div>

                <div style="display: none; gap: 8px; margin: 8px;">
                    <button class="tool-btn" onclick="applyReorder()" id="reorderBtn" style="flex: 1; display: none;">
                        <i data-lucide="arrow-up-down" style="width: 14px; height: 14px; margin-right: 4px;"></i>
                        Apply Reorder
                    </button>
                    <button class="tool-btn" onclick="removeSelectedPages()" id="removePageBtn" style="flex: 1; display: none;">
                        <i data-lucide="trash-2" style="width: 14px; height: 14px; margin-right: 4px;"></i>
                        Remove Selected
                    </button>
                </div>
            </div>

            <!-- Resizer -->
            <div class="panel-resizer" id="thumbnailResizer"></div>

            <!-- Center: PDF Preview -->
            <div class="preview-panel">
                <div class="preview-area" id="previewArea">
                    <div class="placeholder">
                        <i data-lucide="file" style="width: 48px; height: 48px; opacity: 0.4;"></i>
                        <p>PDF preview will appear here</p>
                        <button class="load-btn" onclick="loadPDF()">Load PDF</button>
                    </div>

                    <!-- Hotkeys Display (Bottom Left) -->
                    <div class="preview-hotkeys" id="previewHotkeys" onclick="toggleHotkeys(event)">
                        <div class="hotkey-icon">
                            <i data-lucide="alert-circle" style="width: 16px; height: 16px;"></i>
                        </div>
                        <div class="hotkey-content">
                            <div class="hotkey-item">
                                <kbd>←↑↓→</kbd><span>Move overlay</span>
                            </div>
                            <div class="hotkey-item">
                                <kbd>Alt</kbd><span>+</span><kbd>←↑↓→</kbd><span>Precise move</span>
                            </div>
                            <div class="hotkey-item">
                                <kbd>Del</kbd><span>Delete overlay</span>
                            </div>
                            <div class="hotkey-item">
                                <kbd>Esc</kbd><span>Deselect</span>
                            </div>
                        </div>
                    </div>

                    <!-- Zoom Controls (Bottom Right) -->
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="PreviewController.zoomOut()" title="Zoom Out (Scroll Down)">
                            <i data-lucide="minus" style="width: 14px; height: 14px;"></i>
                        </button>
                        <div class="zoom-display" id="zoomDisplay">100%</div>
                        <button class="zoom-btn" onclick="PreviewController.zoomIn()" title="Zoom In (Scroll Up)">
                            <i data-lucide="plus" style="width: 14px; height: 14px;"></i>
                        </button>
                        <button class="zoom-btn" onclick="PreviewController.zoomFit()" title="Fit to Width">
                            <i data-lucide="maximize-2" style="width: 14px; height: 14px;"></i>
                        </button>
                        <div style="width: 1px; height: 20px; background: var(--brd); margin: 0 4px;"></div>
                        <button class="zoom-btn" id="darkModeBtn" onclick="PreviewController.toggleDarkMode()" title="Toggle Dark Background">
                            <i data-lucide="moon" style="width: 14px; height: 14px;"></i>
                        </button>
                    </div>

                    <!-- Processing Overlay -->
                    <div class="processing-overlay" id="processingOverlay" style="display: none;">
                        <div class="processing-content">
                            <div class="processing-spinner"></div>
                            <div class="processing-text" id="processingText">Processing...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Tools -->
            <div class="tools-panel">
                <!-- Overlays Tool -->
                <div class="tool active" id="t-overlays">
                    <div class="tool-header">
                        <i class="icon" data-lucide="layers"></i>
                        <span class="name">Overlays</span>
                    </div>
                    <div class="tool-body">
                        <div class="tool-desc">Add and edit overlay layers</div>

                        <!-- Add New Section -->
                        <div style="margin-bottom: 16px;">
                            <label class="form-label" style="margin-bottom: 8px;">Add New</label>
                            <div style="display: flex; gap: 4px;">
                                <button class="tool-btn" style="flex: 1; font-size: 10px;" onclick="UIControls.showTextEditor()">
                                    <i data-lucide="type" style="width: 12px; height: 12px;"></i> Text
                                </button>
                                <button class="tool-btn" style="flex: 1; font-size: 10px;" onclick="browseImage()">
                                    <i data-lucide="image" style="width: 12px; height: 12px;"></i> Image
                                </button>
                            </div>
                            <input type="file" id="imageFile" accept="image/*" style="display: none;">
                        </div>

                        <!-- Text Editor Modal (hidden by default) -->
                        <div id="textEditorSection" style="display: none; padding: 12px; background: var(--bg); border: 1px solid var(--brd); border-radius: 4px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <label class="form-label" style="margin: 0;">Text Editor</label>
                                <button onclick="UIControls.closeTextEditor()" style="background: none; border: none; color: var(--txt3); cursor: pointer; padding: 4px;">
                                    <i data-lucide="x" style="width: 14px; height: 14px;"></i>
                                </button>
                            </div>
                            <div class="form-group">
                                <div style="display: flex; gap: 4px;">
                                    <input type="text" class="form-input" id="textContent" placeholder="Enter text..." style="flex: 1;" onkeypress="if(event.key === 'Enter' && !document.getElementById('addTextBtn').disabled) addTextOverlay()">
                                    <button class="toggle-btn" onclick="openDatePicker()" title="Pick Date">
                                        <i data-lucide="calendar" style="width: 12px; height: 12px;"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <button class="toggle-btn" id="dateFormatBtn" onclick="cycleDateFormat()" style="width: 100%; display: none;">
                                    MM/DD/YYYY
                                </button>
                            </div>
                            <button class="tool-btn" id="addTextBtn" onclick="addTextOverlay()" disabled style="width: 100%;">Add Text</button>
                        </div>

                        <!-- Selected Layer Editor (context-sensitive) -->
                        <div id="selectedLayerEditor" style="display: none; padding: 12px; background: var(--bg); border: 1px solid var(--brd); border-radius: 4px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <label class="form-label" style="margin: 0;" id="selectedLayerTitle">Edit Layer</label>
                                <button onclick="SelectionManager.deselectOverlay()" style="background: none; border: none; color: var(--txt3); cursor: pointer; padding: 4px;">
                                    <i data-lucide="x" style="width: 14px; height: 14px;"></i>
                                </button>
                            </div>

                            <!-- Text-specific controls -->
                            <div id="textLayerControls" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">Text Content</label>
                                    <input type="text" class="form-input" id="editTextContent" placeholder="Enter text..." oninput="UIControls.updateLayerText(this.value)">
                                </div>
                                <div class="form-group" id="editDateFormatGroup" style="display: none;">
                                    <label class="form-label">Date Format</label>
                                    <button class="toggle-btn" id="editDateFormatBtn" onclick="cycleSelectedLayerDateFormat()" style="width: 100%;">
                                        MM/DD/YYYY
                                    </button>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Font Family</label>
                                    <input class="form-input" id="editFontFamily" list="fontFamilyList" onchange="UIControls.updateLayerFontFamily(this.value)" placeholder="Select or type font name">
                                    <datalist id="fontFamilyList">
                                        <option value="Helvetica">Helvetica</option>
                                        <option value="Times">Times New Roman</option>
                                        <option value="Courier">Courier</option>
                                        <option value="Arial">Arial</option>
                                        <option value="Georgia">Georgia</option>
                                        <option value="Verdana">Verdana</option>
                                        <option value="Roboto">Roboto</option>
                                        <option value="Open Sans">Open Sans</option>
                                        <option value="Lato">Lato</option>
                                        <option value="Source Sans Pro">Source Sans Pro</option>
                                        <option value="Montserrat">Montserrat</option>
                                        <option value="Oswald">Oswald</option>
                                        <option value="Raleway">Raleway</option>
                                        <option value="PT Sans">PT Sans</option>
                                        <option value="Merriweather">Merriweather</option>
                                        <option value="Nunito">Nunito</option>
                                        <option value="Playfair Display">Playfair Display</option>
                                        <option value="Ubuntu">Ubuntu</option>
                                        <option value="Poppins">Poppins</option>
                                        <option value="Work Sans">Work Sans</option>
                                        <option value="Noto Sans">Noto Sans</option>
                                        <option value="Fira Sans">Fira Sans</option>
                                        <option value="Inter">Inter</option>
                                        <option value="Quicksand">Quicksand</option>
                                        <option value="Josefin Sans">Josefin Sans</option>
                                        <option value="Bebas Neue">Bebas Neue</option>
                                    </datalist>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Text Style</label>
                                    <div style="display: flex; gap: 4px;">
                                        <button class="tool-btn" id="boldBtn" onclick="UIControls.toggleBold()" title="Bold" style="flex: 1;">
                                            <i data-lucide="bold" style="width: 14px; height: 14px;"></i>
                                        </button>
                                        <button class="tool-btn" id="italicBtn" onclick="UIControls.toggleItalic()" title="Italic" style="flex: 1;">
                                            <i data-lucide="italic" style="width: 14px; height: 14px;"></i>
                                        </button>
                                        <button class="tool-btn" id="underlineBtn" onclick="UIControls.toggleUnderline()" title="Underline" style="flex: 1;">
                                            <i data-lucide="underline" style="width: 14px; height: 14px;"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="color-input-group">
                                        <label>Text Color</label>
                                        <div id="textColorPicker"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="color-input-group">
                                        <label>Text Highlight</label>
                                        <div id="highlightColorPicker"></div>
                                    </div>
                                </div>
                                <div class="form-group" id="highlightBlurGroup" style="display: none;">
                                    <label class="form-label">Highlight Fade: <span id="highlightBlurValue">0</span>px</label>
                                    <input type="range" min="0" max="20" value="0" id="highlightBlurSlider" style="width: 100%;" oninput="UIControls.updateHighlightBlur(this.value)">
                                    <div style="font-size: 10px; color: var(--txt3); margin-top: 4px;">
                                        Gradient fade at highlight edges
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Text Blur: <span id="textBlurValue">0</span>px</label>
                                    <input type="range" min="0" max="2" step="0.1" value="0" id="textBlurSlider" style="width: 100%;" oninput="UIControls.updateTextBlur(this.value)">
                                    <div style="font-size: 10px; color: var(--txt3); margin-top: 4px;">
                                        Blur preview (CSS effect)
                                    </div>
                                    <button class="tool-btn" id="convertToImageBtn" onclick="UIControls.convertBlurredTextToImage()" style="width: 100%; display: none; margin-top: 6px;">
                                        <i data-lucide="image" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                                        Convert to Image (Permanent)
                                    </button>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Character Spacing: <span id="letterSpacingValue">0</span>px</label>
                                    <input type="range" min="-2" max="10" step="0.5" value="0" id="letterSpacingSlider" style="width: 100%;" oninput="UIControls.updateLetterSpacing(this.value)">
                                    <div style="font-size: 10px; color: var(--txt3); margin-top: 4px;">
                                        Adjust spacing between characters
                                    </div>
                                </div>
                            </div>

                            <!-- Common controls (opacity) -->
                            <div class="form-group">
                                <label class="form-label">Layer Opacity: <span id="opacityValue">100</span>%</label>
                                <input type="range" min="10" max="100" value="100" id="opacitySlider" style="width: 100%;" oninput="UIControls.updateLayerOpacity(this.value)">
                                <div style="font-size: 10px; color: var(--txt3); margin-top: 4px;">
                                    Controls overall transparency
                                </div>
                            </div>
                        </div>

                        <!-- Recent Images Section -->
                        <div id="recentImagesGroup" style="display: none; margin-bottom: 12px;">
                            <label class="form-label" style="margin-bottom: 8px;">Recent Images</label>
                            <div id="recentImagesList" style="max-height: 100px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px;">
                                <!-- Recent images will be populated here -->
                            </div>
                        </div>

                        <!-- Layers List -->
                        <div id="layersList" style="display: none;">
                            <label class="form-label" style="margin-bottom: 8px;">Layers</label>
                            <div id="layersContainer" style="max-height: 200px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px;">
                                <!-- Layers will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header" id="modalHeader">Notification</div>
            <div class="modal-body" id="modalBody">Modal content</div>
            <div class="modal-footer" id="modalFooter">
                <button class="modal-btn modal-btn-primary" onclick="closeModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal" style="display: none;">
        <div class="share-modal">
            <div class="share-header">
                <div class="share-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px;">
                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                        <polyline points="16 6 12 2 8 6"></polyline>
                        <line x1="12" y1="2" x2="12" y2="15"></line>
                    </svg>
                </div>
                <h3>Spread the word?</h3>
                <p>If you find this useful, let your friends know!</p>
            </div>

            <!-- Social media buttons -->
            <div class="share-socials">
                <button type="button" onclick="handleSocialShare('twitter')" title="Share on X" class="share-social-btn share-twitter">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                </button>
                <button type="button" onclick="handleSocialShare('facebook')" title="Share on Facebook" class="share-social-btn share-facebook">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                </button>
                <button type="button" onclick="handleSocialShare('linkedin')" title="Share on LinkedIn" class="share-social-btn share-linkedin">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                </button>
                <button type="button" onclick="handleSocialShare('reddit')" title="Share on Reddit" class="share-social-btn share-reddit">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
                </button>
                <button type="button" onclick="handleSocialShare('whatsapp')" title="Share on WhatsApp" class="share-social-btn share-whatsapp">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                </button>
                <button type="button" onclick="handleSocialShare('telegram')" title="Share on Telegram" class="share-social-btn share-telegram">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                </button>
            </div>

            <!-- Copy link and email row -->
            <div class="share-actions">
                <button type="button" onclick="handleCopyLink()" class="share-action-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 16px; height: 16px;"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                    Copy Link
                </button>
                <button type="button" onclick="handleEmailShare()" class="share-action-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 16px; height: 16px;"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                    Email
                </button>
            </div>

            <!-- Maybe later -->
            <button type="button" onclick="closeShareModal()" class="share-later-btn">Maybe Later</button>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" accept=".pdf" style="display: none;">

    <!-- Modular Scripts -->
    <script src="/js/app-state.js"></script>
    <script src="/js/modal-manager.js"></script>
    <script src="/js/folder-opener.js"></script>
    <script src="/js/share-modal.js"></script>
    <script src="/js/date-utils.js"></script>
    <script src="/js/image-manager.js"></script>
    <script src="/js/pdf-loader.js"></script>
    <script src="/js/thumbnail-renderer.js"></script>
    <script src="/js/preview-controller.js"></script>
    <script src="/js/page-operations.js"></script>
    <script src="/js/pdf-export.js"></script>
    <script src="/js/pdf-export-v2.js"></script>
    <script src="/js/background-remover.js"></script>
    <script src="/js/ui-controls.js"></script>
    <script src="/js/gizmo-manager.js"></script>
    <script src="/js/merge-handler.js"></script>
    <script src="/js/tool-manager.js"></script>
    <script src="/js/keyboard-handler.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>
